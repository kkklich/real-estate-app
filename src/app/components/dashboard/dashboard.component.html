<mat-toolbar color="primary">
    <span class="logo">Real Estate Dashboard</span>
    <span class="spacer"></span>
</mat-toolbar>
@if(calculateStatisticsService.hasData()){
<div class="filter-container">
    <app-search-filter (groupByTypeChange)="onGroupByTypeChange($event)"
        (cityChange)="onCityChange($event)"></app-search-filter>
</div>


<div class="dashboard-container">
    @if(this.isBrowser){
    <div class="dashboard-grid">
        <app-line-chart class="line-chart" [labels]="labels" [dataPoints]="dataPoints" [countPoints]="countPoints"
            chartTitle="Timeline Average Prices"></app-line-chart>

        <app-info-labels class="info-labels"></app-info-labels>

        <app-bar-chart class="bar-chart-median" [chartData]="barChartDataMedianPricePerMeter"
            [chartTitle]="'Median price per square meter: '"></app-bar-chart>

        <app-bar-chart class="bar-chart-building-type" [chartData]="barChartDataByBuildingType"
            [chartTitle]="'Number of apartments grouped by:  ' + calculateStatisticsService.groupedBy()"></app-bar-chart>
        <!-- âœ… Load map when browser is IDLE (default behavior) -->
        @defer (on idle) {
        <app-map-view class="map-view"></app-map-view>
        } @placeholder {
        <div class="map-placeholder">
            <mat-icon>map</mat-icon>
            <span>ğŸ—ºï¸ Map loads when ready</span>
        </div>
        } @loading (after 300ms; minimum 1s) {
        <div class="map-loading">
            <mat-spinner diameter="30"></mat-spinner>
            <span>Rendering interactive map...</span>
        </div>
        } @error {
        <div class="map-error">
            <mat-icon>error_outline</mat-icon>
            <span>Map unavailable</span>
        </div>
        }

    </div>
    }
</div>
}@else {
<div class="loading-container">
    <mat-spinner></mat-spinner>
    <span>
        <strong>Note:</strong> First API request may take ~2 minutes as our server wakes up (Render hosting cold start).
        Subsequent requests are instant
    </span>
</div>
}